<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>WisdomBase å‰åç«¯è”è°ƒæµ‹è¯•</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family:
          -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu,
          Cantarell, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 20px;
      }

      .container {
        background: white;
        border-radius: 10px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        max-width: 600px;
        width: 100%;
        padding: 40px;
      }

      h1 {
        color: #333;
        margin-bottom: 10px;
        text-align: center;
      }

      .subtitle {
        text-align: center;
        color: #666;
        margin-bottom: 30px;
        font-size: 14px;
      }

      .test-section {
        margin-bottom: 30px;
        padding: 20px;
        background: #f5f5f5;
        border-radius: 8px;
      }

      .test-section h2 {
        font-size: 16px;
        color: #333;
        margin-bottom: 15px;
        border-bottom: 2px solid #667eea;
        padding-bottom: 10px;
      }

      .test-item {
        margin-bottom: 12px;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .test-label {
        font-weight: 500;
        color: #333;
        min-width: 150px;
      }

      .test-result {
        padding: 8px 12px;
        border-radius: 4px;
        font-size: 13px;
        flex: 1;
        word-break: break-all;
      }

      .result-loading {
        background: #e3f2fd;
        color: #1976d2;
      }

      .result-success {
        background: #e8f5e9;
        color: #388e3c;
      }

      .result-error {
        background: #ffebee;
        color: #d32f2f;
      }

      .button-group {
        display: flex;
        gap: 10px;
        margin-top: 20px;
        flex-wrap: wrap;
      }

      button {
        flex: 1;
        min-width: 120px;
        padding: 10px 20px;
        border: none;
        border-radius: 4px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s;
      }

      .btn-primary {
        background: #667eea;
        color: white;
      }

      .btn-primary:hover {
        background: #5568d3;
      }

      .btn-primary:disabled {
        background: #ccc;
        cursor: not-allowed;
      }

      .btn-secondary {
        background: #f5f5f5;
        color: #333;
        border: 1px solid #ddd;
      }

      .btn-secondary:hover {
        background: #e8e8e8;
      }

      .status-badge {
        display: inline-block;
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 500;
        margin-left: 10px;
      }

      .badge-success {
        background: #e8f5e9;
        color: #388e3c;
      }

      .badge-error {
        background: #ffebee;
        color: #d32f2f;
      }

      .response-box {
        background: #1e1e1e;
        color: #00ff00;
        padding: 15px;
        border-radius: 4px;
        font-family: "Courier New", monospace;
        font-size: 12px;
        max-height: 300px;
        overflow-y: auto;
        margin-top: 10px;
        white-space: pre-wrap;
        word-break: break-all;
      }

      .info-box {
        background: #fff3cd;
        border: 1px solid #ffc107;
        color: #856404;
        padding: 12px;
        border-radius: 4px;
        margin-bottom: 20px;
        font-size: 14px;
      }

      .spinner {
        display: inline-block;
        width: 12px;
        height: 12px;
        border: 2px solid #1976d2;
        border-top-color: transparent;
        border-radius: 50%;
        animation: spin 0.6s linear infinite;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>ğŸ‰ WisdomBase å‰åç«¯è”è°ƒæµ‹è¯•</h1>
      <p class="subtitle">ç‚¹å‡»æŒ‰é’®è¿›è¡Œæµ‹è¯•</p>

      <div class="info-box">
        â„¹ï¸ ç¡®ä¿åç«¯è¿è¡Œåœ¨ http://localhost:8000 å’Œå‰ç«¯åœ¨ http://localhost:8848
      </div>

      <!-- ç³»ç»Ÿä¿¡æ¯ -->
      <div class="test-section">
        <h2>ğŸ“Š ç³»ç»Ÿä¿¡æ¯</h2>
        <div class="test-item">
          <span class="test-label">å‰ç«¯åœ°å€:</span>
          <span class="test-result" id="frontend-url">-</span>
        </div>
        <div class="test-item">
          <span class="test-label">åç«¯åœ°å€:</span>
          <span class="test-result" id="backend-url"
            >http://localhost:8000</span
          >
        </div>
        <div class="test-item">
          <span class="test-label">ä»£ç†é…ç½®:</span>
          <span class="test-result">/api/* â†’ http://localhost:8000</span>
        </div>
      </div>

      <!-- è¿æ¥æµ‹è¯• -->
      <div class="test-section">
        <h2>ğŸ”— è¿æ¥æµ‹è¯•</h2>
        <div class="test-item">
          <span class="test-label">åç«¯è¿æ¥:</span>
          <span class="test-result" id="backend-status">æœªæµ‹è¯•</span>
        </div>
        <div class="test-item">
          <span class="test-label">API å“åº”:</span>
          <span class="test-result" id="api-status">æœªæµ‹è¯•</span>
        </div>
        <button class="btn-primary" onclick="testConnection()">æµ‹è¯•è¿æ¥</button>
      </div>

      <!-- ç™»å½•æµ‹è¯• -->
      <div class="test-section">
        <h2>ğŸ” ç™»å½•æµ‹è¯•</h2>
        <div class="test-item">
          <span class="test-label">Admin ç™»å½•:</span>
          <span class="test-result" id="login-admin">æœªæµ‹è¯•</span>
        </div>
        <div class="test-item">
          <span class="test-label">Editor ç™»å½•:</span>
          <span class="test-result" id="login-editor">æœªæµ‹è¯•</span>
        </div>
        <div class="test-item">
          <span class="test-label">Viewer ç™»å½•:</span>
          <span class="test-result" id="login-viewer">æœªæµ‹è¯•</span>
        </div>
        <div class="button-group">
          <button class="btn-primary" onclick="testLogin('admin', 'admin123')">
            æµ‹è¯• Admin
          </button>
          <button
            class="btn-primary"
            onclick="testLogin('editor', 'editor123')"
          >
            æµ‹è¯• Editor
          </button>
          <button
            class="btn-primary"
            onclick="testLogin('viewer', 'viewer123')"
          >
            æµ‹è¯• Viewer
          </button>
        </div>
      </div>

      <!-- è¯¦ç»†å“åº” -->
      <div class="test-section">
        <h2>ğŸ“‹ è¯¦ç»†å“åº”</h2>
        <div class="response-box" id="response-box">ç­‰å¾…æµ‹è¯•...</div>
      </div>

      <!-- æ“ä½œæŒ‰é’® -->
      <div class="button-group">
        <button class="btn-secondary" onclick="clearResults()">æ¸…é™¤ç»“æœ</button>
        <button class="btn-primary" onclick="runAllTests()">
          è¿è¡Œå…¨éƒ¨æµ‹è¯•
        </button>
      </div>
    </div>

    <script>
      // åˆå§‹åŒ–å‰ç«¯ URL
      document.getElementById("frontend-url").textContent =
        window.location.origin;

      // è¾“å‡ºæ¶ˆæ¯
      function log(message) {
        const box = document.getElementById("response-box");
        box.textContent += message + "\n";
        box.scrollTop = box.scrollHeight;
      }

      // è®¾ç½®çŠ¶æ€
      function setStatus(elementId, status, message) {
        const element = document.getElementById(elementId);
        element.textContent = message;
        element.className = "test-result result-" + status;
        if (status === "loading") {
          element.innerHTML = '<span class="spinner"></span> ' + message;
        }
      }

      // æµ‹è¯•è¿æ¥
      async function testConnection() {
        log("========== æµ‹è¯•è¿æ¥ ==========");
        setStatus("backend-status", "loading", "è¿æ¥ä¸­...");
        setStatus("api-status", "loading", "æµ‹è¯•ä¸­...");

        try {
          const response = await fetch("http://localhost:8000/health");
          if (response.ok) {
            const data = await response.json();
            setStatus("backend-status", "success", "âœ“ è¿æ¥æˆåŠŸ");
            setStatus("api-status", "success", "âœ“ API å“åº”æ­£å¸¸");
            log("åç«¯å“åº”: " + JSON.stringify(data, null, 2));
          } else {
            setStatus(
              "backend-status",
              "error",
              "âœ— è¿æ¥å¤±è´¥ (HTTP " + response.status + ")",
            );
            setStatus("api-status", "error", "âœ— API å“åº”å¼‚å¸¸");
          }
        } catch (error) {
          setStatus("backend-status", "error", "âœ— æ— æ³•è¿æ¥");
          setStatus("api-status", "error", "âœ— " + error.message);
          log("é”™è¯¯: " + error.message);
        }
      }

      // æµ‹è¯•ç™»å½•
      async function testLogin(username, password) {
        log(`========== æµ‹è¯• ${username} ç™»å½• ==========`);
        const elementId = "login-" + username;
        setStatus(elementId, "loading", "ç™»å½•ä¸­...");

        try {
          const response = await fetch(
            "http://localhost:8000/api/v1/auth/login",
            {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({
                username: username,
                password: password,
              }),
            },
          );

          const data = await response.json();
          if (data.success) {
            setStatus(
              elementId,
              "success",
              "âœ“ ç™»å½•æˆåŠŸ (ID: " + data.data.username + ")",
            );
            log("ç™»å½•æˆåŠŸ: " + JSON.stringify(data.data, null, 2));
          } else {
            setStatus(elementId, "error", "âœ— ç™»å½•å¤±è´¥: " + data.message);
            log("ç™»å½•å¤±è´¥: " + JSON.stringify(data, null, 2));
          }
        } catch (error) {
          setStatus(elementId, "error", "âœ— è¯·æ±‚å¤±è´¥: " + error.message);
          log("é”™è¯¯: " + error.message);
        }
      }

      // æ¸…é™¤ç»“æœ
      function clearResults() {
        document.getElementById("response-box").textContent = "ç­‰å¾…æµ‹è¯•...";
        document.getElementById("backend-status").textContent = "æœªæµ‹è¯•";
        document.getElementById("backend-status").className = "test-result";
        document.getElementById("api-status").textContent = "æœªæµ‹è¯•";
        document.getElementById("api-status").className = "test-result";
        ["admin", "editor", "viewer"].forEach((role) => {
          document.getElementById("login-" + role).textContent = "æœªæµ‹è¯•";
          document.getElementById("login-" + role).className = "test-result";
        });
      }

      // è¿è¡Œå…¨éƒ¨æµ‹è¯•
      async function runAllTests() {
        clearResults();
        log("========== å¼€å§‹å…¨éƒ¨æµ‹è¯• ==========\n");

        await testConnection();
        await new Promise((r) => setTimeout(r, 500));

        await testLogin("admin", "admin123");
        await new Promise((r) => setTimeout(r, 500));

        await testLogin("editor", "editor123");
        await new Promise((r) => setTimeout(r, 500));

        await testLogin("viewer", "viewer123");

        log("\n========== æµ‹è¯•å®Œæˆ ==========");
      }

      // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æµ‹è¯•è¿æ¥
      window.addEventListener("load", () => {
        setTimeout(() => {
          log("âœ“ é¡µé¢åŠ è½½å®Œæˆï¼Œå¯ä»¥å¼€å§‹æµ‹è¯•");
        }, 100);
      });
    </script>
  </body>
</html>
